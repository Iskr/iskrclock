<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å–Ω–∞ - IskrCLOCK</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 700px;
            width: 100%;
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 10px;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }

        .mode-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
        }

        .mode-btn {
            flex: 1;
            padding: 15px;
            background: #e0e0e0;
            border: 2px solid transparent;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            font-weight: 600;
        }

        .mode-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
        }

        .input-section {
            margin-bottom: 30px;
        }

        label {
            display: block;
            font-size: 16px;
            color: #333;
            margin-bottom: 10px;
            font-weight: 600;
        }

        input[type="time"] {
            width: 100%;
            padding: 15px;
            font-size: 20px;
            border: 2px solid #ddd;
            border-radius: 10px;
            outline: none;
        }

        input[type="time"]:focus {
            border-color: #667eea;
        }

        .calculate-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 30px;
        }

        .calculate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .results {
            display: none;
        }

        .results.show {
            display: block;
        }

        .results-title {
            font-size: 20px;
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
            text-align: center;
        }

        .info-box {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid #2196F3;
        }

        .info-box p {
            color: #1565C0;
            font-size: 14px;
            line-height: 1.6;
        }

        .time-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }

        .time-option {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            transition: all 0.3s;
            cursor: pointer;
        }

        .time-option:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }

        .time-option.best {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            position: relative;
        }

        .time-option.best::before {
            content: attr(data-best-label);
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            background: #FFC107;
            color: #333;
            padding: 3px 10px;
            border-radius: 5px;
            font-size: 12px;
            font-weight: bold;
        }

        .time-value {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .cycles-count {
            font-size: 14px;
            opacity: 0.9;
        }

        .btn-back {
            background: rgba(255, 165, 0, 0.9);
            color: white;
            padding: 15px;
            width: 100%;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 20px;
        }

        .btn-back:hover {
            background: rgba(255, 165, 0, 1);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 165, 0, 0.4);
        }

        @media (max-width: 600px) {
            .time-options {
                grid-template-columns: repeat(2, 1fr);
            }

            .time-value {
                font-size: 24px;
            }
        }

        .lang-selector {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            color: white;
            padding: 10px 15px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            font-size: 14px;
            cursor: pointer;
            outline: none;
            transition: all 0.3s;
            z-index: 1000;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .lang-selector:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .lang-selector option {
            background: #4facfe;
            color: white;
        }
    </style>
</head>
<body>
    <select class="lang-selector">
        <option value="ru">üá∑üá∫ –†—É—Å—Å–∫–∏–π</option>
        <option value="en">üá¨üáß English</option>
    </select>

    <div class="container">
        <h1 class="page-title">üßÆ –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å–Ω–∞</h1>
        <p class="subtitle">–°—Ä–µ–¥–Ω–∏–π —Ü–∏–∫–ª —Å–Ω–∞ —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç 90 –º–∏–Ω—É—Ç</p>

        <div class="mode-selector">
            <div class="mode-btn active" onclick="selectMode('wakeup')" id="wakeupModeBtn">
                <span class="mode-wakeup-text">üåÖ –ö–æ–≥–¥–∞ –ø—Ä–æ—Å–Ω—É—Ç—å—Å—è?</span>
            </div>
            <div class="mode-btn" onclick="selectMode('bedtime')" id="bedtimeModeBtn">
                <span class="mode-bedtime-text">üò¥ –ö–æ–≥–¥–∞ –ª–µ—á—å —Å–ø–∞—Ç—å?</span>
            </div>
        </div>

        <div class="input-section">
            <label id="inputLabel">–í–æ —Å–∫–æ–ª—å–∫–æ –≤—ã —Ö–æ—Ç–∏—Ç–µ –ª–µ—á—å —Å–ø–∞—Ç—å?</label>
            <input type="time" id="timeInput" value="23:00">
        </div>

        <button class="calculate-btn" onclick="calculate()"><span class="calculate-btn-text">üîÆ –†–∞—Å—Å—á–∏—Ç–∞—Ç—å</span></button>

        <div class="results" id="results">
            <div class="info-box">
                <p id="infoText">
                    –°—Ä–µ–¥–Ω–µ—Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–æ–º—É —á–µ–ª–æ–≤–µ–∫—É –Ω—É–∂–Ω–æ –æ–∫–æ–ª–æ 14 –º–∏–Ω—É—Ç, —á—Ç–æ–±—ã –∑–∞—Å–Ω—É—Ç—å.
                    –ü—Ä–æ—Å—ã–ø–∞—Ç—å—Å—è –ª—É—á—à–µ –≤—Å–µ–≥–æ –º–µ–∂–¥—É —Ü–∏–∫–ª–∞–º–∏ —Å–Ω–∞, –∞ –Ω–µ –≤–æ –≤—Ä–µ–º—è –≥–ª—É–±–æ–∫–æ–π —Ñ–∞–∑—ã.
                </p>
            </div>

            <h3 class="results-title" id="resultsTitle"></h3>
            <div class="time-options" id="timeOptions"></div>
        </div>

        <button class="btn-back" onclick="window.location.href='index.html'"><span class="btn-back-text">‚Üê –ù–∞–∑–∞–¥ –∫ –±—É–¥–∏–ª—å–Ω–∏–∫—É</span></button>
    </div>

    <script>
        let currentMode = 'wakeup';
        const SLEEP_CYCLE = 90; // minutes
        const FALL_ASLEEP_TIME = 14; // minutes

        function selectMode(mode) {
            currentMode = mode;
            const wakeupBtn = document.getElementById('wakeupModeBtn');
            const bedtimeBtn = document.getElementById('bedtimeModeBtn');
            const inputLabel = document.getElementById('inputLabel');
            const results = document.getElementById('results');
            const t = translations[currentLang];

            if (mode === 'wakeup') {
                wakeupBtn.classList.add('active');
                bedtimeBtn.classList.remove('active');
                inputLabel.textContent = t.inputLabelWakeup;
            } else {
                bedtimeBtn.classList.add('active');
                wakeupBtn.classList.remove('active');
                inputLabel.textContent = t.inputLabelBedtime;
            }

            results.classList.remove('show');
        }

        function calculate() {
            const timeInput = document.getElementById('timeInput').value;
            const t = translations[currentLang];

            if (!timeInput) {
                alert(t.alertSelectTime);
                return;
            }

            const [hours, minutes] = timeInput.split(':').map(Number);
            const inputDate = new Date();
            inputDate.setHours(hours, minutes, 0, 0);

            const results = document.getElementById('results');
            const resultsTitle = document.getElementById('resultsTitle');
            const timeOptions = document.getElementById('timeOptions');
            const infoText = document.getElementById('infoText');

            timeOptions.innerHTML = '';

            if (currentMode === 'wakeup') {
                resultsTitle.textContent = t.resultsTitleWakeup;
                infoText.innerHTML = t.infoTextWakeup
                    .replace('{time}', `<strong>${formatTime(inputDate)}</strong>`)
                    .replace('{minutes}', FALL_ASLEEP_TIME);

                // Add fall asleep time
                const fallAsleepDate = new Date(inputDate.getTime() + FALL_ASLEEP_TIME * 60000);

                // Calculate wake up times for 4, 5, 6 cycles (6, 7.5, 9 hours)
                const cycles = [4, 5, 6];
                cycles.forEach((cycle, index) => {
                    const wakeTime = new Date(fallAsleepDate.getTime() + cycle * SLEEP_CYCLE * 60000);
                    const hours = cycle * SLEEP_CYCLE / 60;

                    const option = document.createElement('div');
                    option.className = 'time-option' + (index === 1 ? ' best' : '');
                    if (index === 1) {
                        option.setAttribute('data-best-label', t.bestLabel);
                    }
                    option.innerHTML = `
                        <div class="time-value">${formatTime(wakeTime)}</div>
                        <div class="cycles-count">${cycle} ${t.cyclesLabel} (${hours} ${t.hoursLabel})</div>
                    `;
                    timeOptions.appendChild(option);
                });
            } else {
                resultsTitle.textContent = t.resultsTitleBedtime;
                infoText.innerHTML = t.infoTextBedtime
                    .replace('{time}', `<strong>${formatTime(inputDate)}</strong>`)
                    .replace('{minutes}', FALL_ASLEEP_TIME);

                // Calculate bedtimes for 4, 5, 6 cycles
                const cycles = [6, 5, 4];
                cycles.forEach((cycle, index) => {
                    const totalMinutes = cycle * SLEEP_CYCLE + FALL_ASLEEP_TIME;
                    const bedTime = new Date(inputDate.getTime() - totalMinutes * 60000);
                    const hours = cycle * SLEEP_CYCLE / 60;

                    const option = document.createElement('div');
                    option.className = 'time-option' + (index === 1 ? ' best' : '');
                    if (index === 1) {
                        option.setAttribute('data-best-label', t.bestLabel);
                    }
                    option.innerHTML = `
                        <div class="time-value">${formatTime(bedTime)}</div>
                        <div class="cycles-count">${cycle} ${t.cyclesLabel} (${hours} ${t.hoursLabel})</div>
                    `;
                    timeOptions.appendChild(option);
                });
            }

            results.classList.add('show');
        }

        function formatTime(date) {
            const hours = date.getHours();
            const minutes = date.getMinutes();
            return `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}`;
        }

        // Set current time
        const now = new Date();
        document.getElementById('timeInput').value = formatTime(now);

        // ========== Translation System ==========
        const translations = {
            ru: {
                pageTitle: 'üßÆ –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å–Ω–∞',
                documentTitle: '–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å–Ω–∞ - IskrCLOCK',
                subtitle: '–°—Ä–µ–¥–Ω–∏–π —Ü–∏–∫–ª —Å–Ω–∞ —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç 90 –º–∏–Ω—É—Ç',
                modeWakeup: 'üåÖ –ö–æ–≥–¥–∞ –ø—Ä–æ—Å–Ω—É—Ç—å—Å—è?',
                modeBedtime: 'üò¥ –ö–æ–≥–¥–∞ –ª–µ—á—å —Å–ø–∞—Ç—å?',
                inputLabelWakeup: '–í–æ —Å–∫–æ–ª—å–∫–æ –≤—ã —Ö–æ—Ç–∏—Ç–µ –ª–µ—á—å —Å–ø–∞—Ç—å?',
                inputLabelBedtime: '–í–æ —Å–∫–æ–ª—å–∫–æ –≤—ã —Ö–æ—Ç–∏—Ç–µ –ø—Ä–æ—Å–Ω—É—Ç—å—Å—è?',
                calculateBtn: 'üîÆ –†–∞—Å—Å—á–∏—Ç–∞—Ç—å',
                alertSelectTime: '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –≤—Ä–µ–º—è',
                resultsTitleWakeup: '‚è∞ –í–∞–º —Å—Ç–æ–∏—Ç –ø—Ä–æ—Å–Ω—É—Ç—å—Å—è –≤:',
                resultsTitleBedtime: 'üò¥ –í–∞–º —Å—Ç–æ–∏—Ç –ª–µ—á—å —Å–ø–∞—Ç—å –≤:',
                infoTextWakeup: '–ï—Å–ª–∏ –≤—ã –ª—è–∂–µ—Ç–µ —Å–ø–∞—Ç—å –≤ {time} –∏ –∑–∞—Å–Ω–µ—Ç–µ –ø—Ä–∏–º–µ—Ä–Ω–æ —á–µ—Ä–µ–∑ {minutes} –º–∏–Ω—É—Ç, –ª—É—á—à–µ–µ –≤—Ä–µ–º—è –¥–ª—è –ø—Ä–æ–±—É–∂–¥–µ–Ω–∏—è:',
                infoTextBedtime: '–ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –ø—Ä–æ—Å–Ω—É—Ç—å—Å—è –≤ {time}, –ª—É—á—à–µ–µ –≤—Ä–µ–º—è —á—Ç–æ–±—ã –ª–µ—á—å —Å–ø–∞—Ç—å (—Å —É—á–µ—Ç–æ–º {minutes} –º–∏–Ω –Ω–∞ –∑–∞—Å—ã–ø–∞–Ω–∏–µ):',
                cyclesLabel: '—Ü–∏–∫–ª–æ–≤',
                hoursLabel: '—á',
                bestLabel: '‚≠ê –õ—É—á—à–µ–µ',
                btnBack: '‚Üê –ù–∞–∑–∞–¥ –∫ –±—É–¥–∏–ª—å–Ω–∏–∫—É'
            },
            en: {
                pageTitle: 'üßÆ Sleep Calculator',
                documentTitle: 'Sleep Calculator - IskrCLOCK',
                subtitle: 'Average sleep cycle is 90 minutes',
                modeWakeup: 'üåÖ When to wake up?',
                modeBedtime: 'üò¥ When to go to bed?',
                inputLabelWakeup: 'What time do you want to go to bed?',
                inputLabelBedtime: 'What time do you want to wake up?',
                calculateBtn: 'üîÆ Calculate',
                alertSelectTime: 'Please select a time',
                resultsTitleWakeup: '‚è∞ You should wake up at:',
                resultsTitleBedtime: 'üò¥ You should go to bed at:',
                infoTextWakeup: 'If you go to bed at {time} and fall asleep in about {minutes} minutes, the best time to wake up is:',
                infoTextBedtime: 'If you want to wake up at {time}, the best time to go to bed (accounting for {minutes} min to fall asleep):',
                cyclesLabel: 'cycles',
                hoursLabel: 'h',
                bestLabel: '‚≠ê Best',
                btnBack: '‚Üê Back to Alarm'
            }
        };

        let currentLang = localStorage.getItem('language') || 'ru';

        function switchLanguage(lang) {
            currentLang = lang;
            localStorage.setItem('language', lang);
            const t = translations[lang];

            // Update document title
            document.title = t.documentTitle;

            // Update page elements
            const pageTitle = document.querySelector('.page-title');
            if (pageTitle) pageTitle.textContent = t.pageTitle;

            const subtitle = document.querySelector('.subtitle');
            if (subtitle) subtitle.textContent = t.subtitle;

            // Update mode buttons
            const modeWakeupText = document.querySelector('.mode-wakeup-text');
            if (modeWakeupText) modeWakeupText.textContent = t.modeWakeup;

            const modeBedtimeText = document.querySelector('.mode-bedtime-text');
            if (modeBedtimeText) modeBedtimeText.textContent = t.modeBedtime;

            // Update input label based on current mode
            const inputLabel = document.getElementById('inputLabel');
            if (inputLabel) {
                inputLabel.textContent = currentMode === 'wakeup' ? t.inputLabelWakeup : t.inputLabelBedtime;
            }

            // Update calculate button
            const calculateBtnText = document.querySelector('.calculate-btn-text');
            if (calculateBtnText) calculateBtnText.textContent = t.calculateBtn;

            // Update back button
            const btnBackText = document.querySelector('.btn-back-text');
            if (btnBackText) btnBackText.textContent = t.btnBack;

            // Update results if they are visible
            const results = document.getElementById('results');
            if (results.classList.contains('show')) {
                // Recalculate to update with new translations
                const timeOptions = document.querySelectorAll('.time-option');
                timeOptions.forEach((option, index) => {
                    const cyclesCount = option.querySelector('.cycles-count');
                    if (cyclesCount) {
                        const cycleNum = cyclesCount.textContent.match(/\d+/)[0];
                        const hoursNum = cyclesCount.textContent.match(/\(([0-9.]+)/)[1];
                        cyclesCount.textContent = `${cycleNum} ${t.cyclesLabel} (${hoursNum} ${t.hoursLabel})`;
                    }

                    // Update best label
                    if (option.classList.contains('best')) {
                        option.setAttribute('data-best-label', t.bestLabel);
                    }
                });

                const resultsTitle = document.getElementById('resultsTitle');
                if (resultsTitle) {
                    resultsTitle.textContent = currentMode === 'wakeup' ? t.resultsTitleWakeup : t.resultsTitleBedtime;
                }

                const infoText = document.getElementById('infoText');
                if (infoText) {
                    const timeMatch = infoText.innerHTML.match(/<strong>([^<]+)<\/strong>/);
                    if (timeMatch) {
                        const time = timeMatch[1];
                        const infoTextTemplate = currentMode === 'wakeup' ? t.infoTextWakeup : t.infoTextBedtime;
                        infoText.innerHTML = infoTextTemplate
                            .replace('{time}', `<strong>${time}</strong>`)
                            .replace('{minutes}', FALL_ASLEEP_TIME);
                    }
                }
            }

            document.querySelector('.lang-selector').value = lang;
        }

        document.querySelector('.lang-selector').addEventListener('change', (e) => {
            switchLanguage(e.target.value);
        });

        // Set initial language
        const langSelector = document.querySelector('.lang-selector');
        langSelector.value = currentLang;
        if (currentLang === 'en') {
            switchLanguage('en');
        } else {
            switchLanguage('ru');
        }
    </script>
</body>
</html>
